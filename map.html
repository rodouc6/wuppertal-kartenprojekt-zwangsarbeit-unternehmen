<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<title>Zwangsarbeit Wuppertal – Karte & Unternehmen</title>

<!-- Leaflet -->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>

<script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js">
</script>

<link rel="stylesheet" href="style.css">

<style>
/* Layout für Karte + Liste */
#layout {
  display: flex;
  height: calc(100vh - 50px);
}

#map {
  width: 66%;
}

#list {
  width: 34%;
  overflow-y: auto;
  padding: 10px;
  border-left: 1px solid #ccc;
  font-size: 13px;
}

.entry {
  padding: 6px;
  border-bottom: 1px solid #ddd;
  cursor: pointer;
}

.entry:hover {
  background: #f0f0f0;
}
</style>
</head>

<body>

<nav>
  <a href="index.html">Start</a>
  <a href="map.html">Karte & Unternehmen</a>
  <a href="about.html">Impressum</a>
</nav>

<div id="layout">

  <div id="map"></div>

  <div id="list">
    <h3>Unternehmen (alphabetisch)</h3>
    <div id="entries"></div>
  </div>

</div>

<script>
/* ===============================
   KARTE
================================ */
const map = L.map('map').setView([51.2562, 7.1508], 12);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap'
}).addTo(map);

/* ===============================
   DATEN
================================ */
let allFeatures = [];
let markerMap = {};

fetch("data/unternehmen.geojson")
  .then(res => res.json())
  .then(data => {
    allFeatures = data.features;

    buildMap();
    buildList();
  });

/* ===============================
   MARKER
================================ */
function buildMap() {
  allFeatures.forEach(f => {
    const lat = f.geometry.coordinates[1];
    const lon = f.geometry.coordinates[0];

    const marker = L.circleMarker([lat, lon], {
      radius: 6,
      color: "#000",
      weight: 1,
      fillColor: "#cc0000",
      fillOpacity: 0.8
    })
    .addTo(map)
    .bindPopup(`
      <b>${f.properties.Unternehmen}</b><br>
      ${f.properties.Adresse || ""}
    `);

    markerMap[f.properties["Nr."]] = marker;
  });
}

/* ===============================
   LISTE
================================ */
function buildList() {
  const container = document.getElementById("entries");
  container.innerHTML = "";

  allFeatures
    .sort((a, b) =>
      a.properties["Nr."].localeCompare(b.properties["Nr."])
    )
    .forEach(f => {
      const div = document.createElement("div");
      div.className = "entry";

      div.innerHTML = `
        <b>${f.properties["Nr."]}</b><br>
        ${f.properties.Unternehmen}<br>
        <small>${f.properties.Adresse || ""}, ${f.properties.Ort || ""}</small>
      `;

      div.onclick = () => {
        const marker = markerMap[f.properties.["Nr."]];
        map.setView(marker.getLatLng(), 16);
        marker.openPopup();
      };

      container.appendChild(div);
    });
}
</script>

</body>
</html>
